/****************************** File *********************************Module: dim3 EditorAuthor: Brian Barnes Usage: Portal View Drawing Routines***************************** License ********************************This code can be freely used as long as these conditions are met:1. This header, in its entirety, is kept with the code2. This credit ÒCreated with dim3 TechnologyÓ is given on a singleapplication screen and in a single piece of the documentation3. It is not resold, in it's current form or modified, as anengine-only productThis code is presented as is. The author of dim3 takes noresponsibilities for any version of this code.Any non-engine product (games, etc) created with this code is freefrom any and all payment and/or royalties to the author of dim3,and can be sold or given away.(c) 2000-2007 Klink! Software www.klinksoftware.com *********************************************************************/#include "interface.h"#include "portal_view.h"extern map_type				map;extern int					cx,cz,magnify_factor;extern float				walk_view_y_angle;extern Rect					portal_view_box;/* =======================================================      Portal Sizes      ======================================================= */void portal_view_get_portal(int rn,int *x,int *z,int *ex,int *ez){	portal_type		*portal;		portal=&map.portals[rn];		*x=portal->x;	*z=portal->z;	portal_view_map_to_pane(x,z);		*ex=portal->ex;	*ez=portal->ez;	portal_view_map_to_pane(ex,ez);}/* =======================================================      Draw Portal View Walls      ======================================================= */void portal_view_draw_portal_walls(int rn){	register int				i,x,z;	int							lx,rx,lz,rz;	register segment_type		*seg;	register wall_segment_data  *wall;	RGBColor					blackcolor={0x0,0x0,0x0},bluecolor={0x0,0x0,0xFFFF};			// room x,z			x=map.portals[rn].x;	z=map.portals[rn].z;			// draw walls		RGBForeColor(&bluecolor);		seg=map.segments;			for (i=0;i!=map.nsegment;i++) {			if ((seg->type==sg_wall) && (seg->rn==rn)) {					wall=&seg->data.wall;						lx=wall->lx+x;			lz=wall->lz+z;			portal_view_map_to_pane(&lx,&lz);			rx=wall->rx+x;			rz=wall->rz+z;			portal_view_map_to_pane(&rx,&rz);						MoveTo(lx,lz);				LineTo(rx,rz);		}				seg++;	}		RGBForeColor(&blackcolor);}/* =======================================================      Draw Portal Position      ======================================================= */void portal_view_portal_position_draw(void){    int			x,z,k,px[4],pz[4];       x=cx;    z=cz;	portal_view_map_to_pane(&x,&z);		k=(1000*magnify_factor)/magnify_size;		px[0]=x-k;	pz[0]=z+k;		px[1]=x;	pz[1]=z-k;		px[2]=x+k;	pz[2]=z+k;		px[3]=x;	pz[3]=z+(k>>1);		rotate_2D_polygon(4,px,pz,x,z,walk_view_y_angle);		glColor4f(0.0f,0.0f,0.0f,0.75f);		glBegin(GL_QUADS);	glVertex2i(px[0],pz[0]);	glVertex2i(px[1],pz[1]);	glVertex2i(px[2],pz[2]);	glVertex2i(px[3],pz[3]);	glEnd();}